// 删除目录里的node_modules文件夹
import fs from 'fs-extra'
import chalk from 'chalk';
import print from './print.js';

const deleteNFolder = (path) => {
    if (fs.existsSync(path)) {
        fs.readdirSync(path).forEach((file) => {
            const curPath = path + '/' + file;
            if (fs.lstatSync(curPath).isDirectory()) {
                deleteNFolder(curPath);
            } else {
                try {
                    fs.unlinkSync(curPath); // 删除文件
                } catch (error) {
                    console.log(chalk.red('删除文件失败   ')) + chalk.green(curPath);
                }
            }
        });
        try {
            fs.rmdirSync(path); // 删除空文件夹
        } catch (error) {
            console.log(chalk.rgb(150,60,255)('删除文件夹失败 ')) + chalk.green(path);
        }
    }
}

const dirPath = process.cwd() + '/node_modules';

const deleteNodeModules = () => {
    try {
        deleteNFolder(dirPath);
        print('\n删除成功\n');
    } catch (error) {
        console.log(chalk.red('\n删除报错\n') + chalk.green(dirPath));
    }
    try {
        fs.removeSync('node_modules')
        print('\n删除成功\n');
    } catch (error) {
        console.log(chalk.rgb(150,60,255)('\n删除文件夹失败 ') + chalk.green(dirPath));
    }
}

export default deleteNodeModules;
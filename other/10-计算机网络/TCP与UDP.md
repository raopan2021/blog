# TCP与UDP的区别（超详细）

[TCP与UDP的区别（超详细）_董HaoYu的博客-CSDN博客](https://blog.csdn.net/weixin_43796685/article/details/104558965)

### 总结

1. TCP是面向连接的，UDP是无连接的
2. TCP是可靠的，UDP是不可靠的
3. TCP是面向字节流的，UDP是面向数据报文的
4. TCP只支持点对点通信，UDP支持一对一，一对多，多对多
5. TCP报文首部20个字节，UDP首部8个字节
6. TCP有拥塞控制机制，UDP没有
7. TCP协议下双方发送接受缓冲区都有，UDP并无实际意义上的发送缓冲区，但是存在接受缓冲区

#### TCP是面向连接的，UDP是无连接的

在TCP协议进行网络通信时，需要先建立连接，也就是说需要先将客户端与服务器的连接连好，然后在进行数据交互。

```
服务器的listen()函数和accept() 函数确保了连接的建立
```

**因为使用TCP协议时，Linux内核协议栈为TCP连接创建了两个队列**

```
1. 半连接队列：用来保存处于SYN_SENT 和 SYN_RECV状态的请求
2. 全连接队列：accept队列，用来保存正在数据交互（established状态）的客户端连接
```

**全连接队列长度 == 套接字函数listen()的第二个参数+1**

#### TCP是可靠的，UDP是不可靠的

**TCP使用一下方式保证自身发送接受数据可靠**

1. 数据包校验（16为数据校验和）防止发送过来的数据是错误数据
2. 确认序列号，对失序报文进行重排
3. 丢弃重复数据包，防止数据冗余重复
4. 确认应答机制，接收方接受数据之后会发送一个确认
5. 超时重传机制，发送方发出数据后会启动一个定时器，超过该定时器时间依旧未收到对方确认，便会重新发送该数据
6. 流量控制（16位窗口大小）确保接收方收到的数据在自身缓冲区中不会溢出
7. 拥塞控制，保证数据在网络中传播的可靠性，降低丢包的概率，提高TCP的可靠性

**UDP没有上述TCP机制**
\8. 并且如果校验和出错，则UDP会将该报文丢弃

#### TCP面向[字节流](https://so.csdn.net/so/search?q=字节流&spm=1001.2101.3001.7020)，UDP面向数据报

面向字节流是以字节为单位发送数据，并且一个数据包可以以字节大小来拆分成多个数据包，以方便发送。
TCP可以先将数据存放在发送缓冲区中，可以等待数据到一定大小发送，也可以直接发送，没有固定大小可言。
UDP需要每次发送都需要发送固定长度的数据包，如果长度过长需要应用层协议主动将其裁剪到适合长度。

#### TCP只支持点对点通信，UDP支持一对一，一对多，多对多

TCP需要双方建立连接，所以需要点对点通信。
UDP则无需这么复杂。

#### TCP有拥塞控制机制，UDP没有

TCP的拥塞控制可是保证了TCP协议在网络中传输的可靠性，降低重传和丢包的概率。UDP不存在。

#### TCP协议下双方发送接受缓冲区都有，UDP并无实际意义上的发送缓冲区，但是存在接受缓冲区

两者都是全双工，但是UDP需要将自身发送数据先转给Linux内核，然后再由内核发送出去。TCP则是运用自身的滑动窗口来发送数据，并且保证了数据的可靠性。

#### 什么时候选TCP or UDP

对某些实时性要求比较高的情况，选择UDP，比如游戏，媒体通信，实时视频流（直播），即使出现传输错误也可以容忍；其它大部分情况下，HTTP都是用TCP，因为要求传输的内容可靠，不出现丢失